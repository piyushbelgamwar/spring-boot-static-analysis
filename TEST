public static TransformerFactory getTransformerFactory() {
    TransformerFactory transformerFactory = TransformerFactory.newInstance();
    transformerFactory.setAttribute(Feature.SCHEMA_VALIDATION.name(), 1);
    transformerFactory.setAttribute(Feature.VALIDATION_WARNINGS.name(), Boolean.TRUE);
    transformerFactory.setAttribute(Feature.ALLOW_UNRESOLVED_SCHEMA_COMPONENTS.name(), true);
    
    // Configure Saxon Enterprise for whitespace handling
    if (transformerFactory instanceof net.sf.saxon.TransformerFactoryImpl) {
        net.sf.saxon.TransformerFactoryImpl saxonFactory = 
            (net.sf.saxon.TransformerFactoryImpl)transformerFactory;
        
        // Set stricter whitespace policy
        saxonFactory.getConfiguration().setConfigurationProperty(
            net.sf.saxon.lib.FeatureKeys.STRIP_WHITESPACE, "all");
            
        // Configure to strip all whitespace-only text nodes
        saxonFactory.getConfiguration().setStripsWhiteSpace("all");
        
        // Create a space-stripping rule
        saxonFactory.getConfiguration().setSpaceStrippingRule(
            new net.sf.saxon.lib.IgnorableSpaceStrippingRule() {
                @Override
                public int isSpacePreserving(net.sf.saxon.om.NodeName nodeName, 
                                           net.sf.saxon.om.SchemaType schemaType) {
                    return net.sf.saxon.lib.SpaceStrippingRule.STRIP_DEFAULT;
                }
            });
    }
    
    return transformerFactory;
}
